<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Language" content="en" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flexible space with image | Android-ObservableScrollView</title>
<meta name="description" content="Android library to observe scroll events on scrollable views." />
<meta name="robots" content="index" />
<meta property="og:type" content="article" />
<meta property="og:site_name" content="Android-ObservableScrollView | Android library to observe scroll events on scrollable views." />
<meta property="og:title" content="Flexible space with image | Android-ObservableScrollView" />
<meta property="og:url" content="http://ksoichiro.github.io/Android-ObservableScrollView" />
<meta property="og:description" content="Android library to observe scroll events on scrollable views." />
<meta property="og:image" content="/Android-ObservableScrollView/thumbnail.png" />
<meta property="og:locale" content="en" />
<link rel="stylesheet" type="text/css" href="/Android-ObservableScrollView/lib/bootstrap/dist/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="/Android-ObservableScrollView/lib/octicons/octicons/octicons.css" />
<link rel="stylesheet" type="text/css" href="/Android-ObservableScrollView/css/main.css" />
<!--[if lt IE 9]>
<script src="/Android-ObservableScrollView/lib/html5shiv/dist/html5shiv.min.js"></script>
<script src="/Android-ObservableScrollView/lib/respond-minmax/dest/respond.min.js"></script>
<![endif]-->
<link rel="apple-touch-icon" sizes="57x57" href="/Android-ObservableScrollView/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/Android-ObservableScrollView/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/Android-ObservableScrollView/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/Android-ObservableScrollView/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/Android-ObservableScrollView/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/Android-ObservableScrollView/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/Android-ObservableScrollView/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/Android-ObservableScrollView/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/Android-ObservableScrollView/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192"  href="/Android-ObservableScrollView/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/Android-ObservableScrollView/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/Android-ObservableScrollView/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/Android-ObservableScrollView/favicon-16x16.png" />
<link rel="manifest" href="/Android-ObservableScrollView/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/Android-ObservableScrollView/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />
<meta name="base" content="/Android-ObservableScrollView" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-62586232-1', 'auto');
  ga('send', 'pageview');
</script>

</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/Android-ObservableScrollView/">Android-ObservableScrollView</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/Android-ObservableScrollView/docs/overview">Documentation</a></li>
        <li><a href="/Android-ObservableScrollView/docs/faq">FAQ</a></li>
        <li><a href="https://github.com/ksoichiro/Android-ObservableScrollView" title="GitHub"><span class="octicon octicon-mark-github"></span></a></li>
      </ul>
    </div>
  </div>
</nav>


<div class="container">
<p class="visible-xs">
    <button type="button" class="btn-sidebar-toggle" data-toggle="offcanvas">Show menu</button>
</p>
<div id="grid-content">
<div id="sidebar">
    <ul>
        <li><ul><li class="topic"><a href="/Android-ObservableScrollView/docs/overview">Overview</a></li></ul></li>
        
            
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/quick-start/">Quick start</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/dependencies">Dependencies</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/layout">Layout</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/animation">Animation codes</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/example/">Try the example app</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/google-play">Download from Google Play</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/wercker">Download from wercker</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/android-studio">Build on Android Studio</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/eclipse">Build on Eclipse</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/basic/">Basic techniques</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/show-hide-action-bar">Show and hide the ActionBar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/translating-toolbar">Translating the Toolbar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/parallax-image">Parallax image</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/sticky-header">Sticky header</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/flexible-space-toolbar">Flexible space on the Toolbar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/flexible-space-with-image">Flexible space with image</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/filling-gap">Filling gap on top of the Toolbar</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/advanced/">Advanced techniques</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/advanced/sliding-up">Sliding up pattern</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/advanced/viewpager">ViewPager pattern</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/contributor/">For contributors</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/ci">CI</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/update-website">Update website</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/release">Release</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/reference/">Reference</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/supported-widgets">Supported widgets</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/environment">Environment</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/release-notes">Release notes</a></li>
                        
                    
                </ul>
            </li>
        
    </ul>
</div>
<div id="sidebar-main-content">
<h1>Flexible space with image</h1><p>This topic describes how to create flexible space with image,
which are implemented in the following examples.</p>
<ul>
<li>FlexibleSpaceWithImageListViewActivity</li>
<li>FlexibleSpaceWithImageRecyclerViewActivity</li>
<li>FlexibleSpaceWithImageScrollViewActivity</li>
</ul>
<p>First, please check the &quot;<a href="../../docs/basic/flexible-space-toolbar.md">Flexible space on the Toolbar</a>&quot;
tutorial, if you haven&#39;t.  </p>
<hr>
<h2>Using ScrollView</h2><h3>Layout with ScrollView</h3><h4>Basic structure</h4><pre><code class="language-xml">&lt;FrameLayout&gt;
    &lt;ImageView android:id=&quot;@+id/image&quot;/&gt;
    &lt;View android:id=&quot;@+id/overlay&quot;/&gt;
    &lt;ObservableScrollView android:id=&quot;@+id/scroll&quot;&gt;
        &lt;LinearLayout android:orientation=&quot;vertical&quot;&gt;
            &lt;View/&gt;
            &lt;TextView/&gt;
        &lt;/LinearLayout&gt;
    &lt;/ObservableScrollView&gt;
    &lt;LinearLayout android:orientation=&quot;vertical&quot;&gt;
        &lt;TextView android:id=&quot;@+id/title&quot;/&gt;
        &lt;View/&gt;
    &lt;/LinearLayout&gt;
    &lt;FloatingActionButton android:id=&quot;@+id/fab&quot;/&gt;
&lt;/FrameLayout&gt;
</code></pre>
<p>The root <code>FrameLayout</code> is used for moving children separately.</p>
<p><code>ImageView</code>(<code>@id/image</code>) is the image that will be translated with parallax effect.</p>
<p><code>View</code>(<code>@id/overlay</code>) is a overlay view as the name suggests.<br>If you try this Activity in the demo app, you can see the image is fading in and out.
This view overlaps with the image and its opacity is changed by scroll position.</p>
<p><code>LinearLayout</code> and its chlidren are the real title views.<br>You would have read the former tutorial, so I will not explain it so much.</p>
<p><code>FloatingActionButton</code> is a widget from the simple and awesome <a href="https://github.com/makovkastar/FloatingActionButton">FloatingActionButton</a> library.<br>But this is optional, so you can remove it if you are not going to place any buttons.
I added it just because I think it&#39;s a very symbolic widget of the Material Design
and some of you might be interested in it.</p>
<p>To confirm other attributes,
please see <code>res/layout/activity_flexiblespacewithimagescrollview.xml</code> in the example app.</p>
<h3>Initialization</h3><p>Most of the codes are easy and not related to this pattern.<br>Just write the following initialization codes:</p>
<p>Copy the title to the title view (<code>TextView</code>) and set null to the original title:</p>
<pre><code class="language-java">mTitleView.setText(getTitle());
setTitle(null);
</code></pre>
<p>Get the dimension values and save them to fields (to simplify animation codes):</p>
<pre><code class="language-Java">mFlexibleSpaceImageHeight = getResources().getDimensionPixelSize(R.dimen.flexible_space_image_height);
mFlexibleSpaceShowFabOffset = getResources().getDimensionPixelSize(R.dimen.flexible_space_show_fab_offset);
mFabMargin = getResources().getDimensionPixelSize(R.dimen.margin_standard);
mActionBarSize = getActionBarSize();
</code></pre>
<p>Get the views which has ID to fields (to simplify animation codes), and initialize them if necessary:</p>
<pre><code class="language-java">mImageView = findViewById(R.id.image);
mOverlayView = findViewById(R.id.overlay);
mScrollView = (ObservableScrollView) findViewById(R.id.scroll);
mScrollView.setScrollViewCallbacks(this);
mTitleView = (TextView) findViewById(R.id.title);
mFab = findViewById(R.id.fab);
</code></pre>
<p>Although this is not so related to the scroll animation,
you should scale the floating action button (FAB) to 0 in <code>onCreate()</code>,
because we&#39;d like to hide it at the beginning and gradually show (scale) it
by scrolling.</p>
<pre><code class="language-java">ViewHelper.setScaleX(mFab, 0);
ViewHelper.setScaleY(mFab, 0);
</code></pre>
<p>You should also add <code>implements ObservableScrollViewCallbacks</code> to the Activity
and implement those methods as always.</p>
<h3>Animation</h3><p>We use <code>onScrollChanged()</code> to create animation.<br>We&#39;ll write the following codes:</p>
<ul>
<li>Translate the overlay view and the image view</li>
<li>Change the alpha of the overlay view</li>
<li>Translate and scale the title view</li>
<li>Translate the FAB</li>
<li>Show/hide the FAB</li>
</ul>
<p>Let&#39;s see one by one.</p>
<h4>Translate the overlay view and the image view</h4><p>As we implemented in the former tutorials,
to move <code>ImageView</code> which is outside the ScrollView,
we must use <code>-scrollY</code> and divide it by 2 to create &quot;parallax&quot; effect.</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  float flexibleRange = mFlexibleSpaceImageHeight - mActionBarSize;
  int minOverlayTransitionY = mActionBarSize - mOverlayView.getHeight();
  ViewHelper.setTranslationY(mOverlayView, ScrollUtils.getFloat(-scrollY, minOverlayTransitionY, 0));
  ViewHelper.setTranslationY(mImageView, ScrollUtils.getFloat(-scrollY / 2, minOverlayTransitionY, 0));
</code></pre>
<p>Although we want to move the overlay view with the image,
we don&#39;t have to make the scroll speed of the overlay to the same as the image view.
So translate <code>mOverlayView</code> to <code>-scrollY</code> (not <code>-scrollY / 2</code>).</p>
<h4>Change the alpha of the overlay view</h4><p>Calculating the alpha value is easy, just convert the <code>scrollY</code> to range between 0 and 1.
To do this, we divide <code>scrollY</code> by <code>flexibleRange</code> (which we assigned above),
and limit the value range from 0 to 1 by using <code>ScrollUtils.getFloat()</code>.</p>
<pre><code class="language-java">  ViewHelper.setAlpha(mOverlayView, ScrollUtils.getFloat((float) scrollY / flexibleRange, 0, 1));
</code></pre>
<h4>Translate and scale the title view</h4><p>This is almost the same as the &quot;Flexible space on the Toolbar&quot; pattern.
The differences are how to calculate the scale and the translationY.</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  // Codes that are already explained above are omitted

  float scale = 1 + ScrollUtils.getFloat((flexibleRange - scrollY) / flexibleRange, 0, MAX_TEXT_SCALE_DELTA);
  ViewHelper.setPivotX(mTitleView, 0);
  ViewHelper.setPivotY(mTitleView, 0);
  ViewHelper.setScaleX(mTitleView, scale);
  ViewHelper.setScaleY(mTitleView, scale);

  int maxTitleTranslationY = (int) (mFlexibleSpaceImageHeight - mTitleView.getHeight() * scale);
  int titleTranslationY = maxTitleTranslationY - scrollY;
  ViewHelper.setTranslationY(mTitleView, titleTranslationY);
</code></pre>
<h4>Translate the FAB</h4><p>Translating the FAB is actually not related to this topic, but I&#39;ll explain for your reference.</p>
<p>The basic idea is to change the <code>translationY</code> property of the FAB,
but on pre-Honeycomb devices, this doesn&#39;t work when you use <code>setOnClickListener</code>.
To fix the issue, we&#39;ll set the margins of the FrameLayout and lay it out again by calling <code>requestLayout()</code>.</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  // Codes that are already explained above are omitted

  int maxFabTranslationY = mFlexibleSpaceImageHeight - mFab.getHeight() / 2;
  float fabTranslationY = ScrollUtils.getFloat(
      -scrollY + mFlexibleSpaceImageHeight - mFab.getHeight() / 2,
      mActionBarSize - mFab.getHeight() / 2,
      maxFabTranslationY);
  if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.HONEYCOMB) {
    // On pre-honeycomb, ViewHelper.setTranslationX/Y does not set margin,
    // which causes FAB&#39;s OnClickListener not working.
    FrameLayout.LayoutParams lp = (FrameLayout.LayoutParams) mFab.getLayoutParams();
    lp.leftMargin = mOverlayView.getWidth() - mFabMargin - mFab.getWidth();
    lp.topMargin = (int) fabTranslationY;
    mFab.requestLayout();
  } else {
    ViewHelper.setTranslationX(mFab, mOverlayView.getWidth() - mFabMargin - mFab.getWidth());
    ViewHelper.setTranslationY(mFab, fabTranslationY);
  }
</code></pre>
<p>The expression <code>- mFab.getHeight() / 2</code> in the calculation of <code>maxFabTranslationY</code> means
that the half of the FAB overlaps to the image.</p>
<p>And about the <code>fabTranslationY</code> calculation,
you might think that the expression <code>mActionBarSize - mFab.getHeight() / 2</code> for the min value
is meaningless, but this is required when you scroll the view fast.
Because if it scrolls faster than the FAB scaling to 0, it looks as if it just moved away.</p>
<h4>Show/hide the FAB</h4><p>Showing or hiding the FAB is easy.
If the translationY of the FAB exceeds the threshold, then hide it.
Otherwise, show it.</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  // Codes that are already explained above are omitted

  if (fabTranslationY &lt; mFlexibleSpaceShowFabOffset) {
    hideFab();
  } else {
    showFab();
  }
}
</code></pre>
<p><code>hideFab()</code> and <code>showFab()</code> methods can be implemented like this:</p>
<pre><code class="language-java">  private boolean mFabIsShown;

  private void showFab() {
    if (!mFabIsShown) {
      ViewPropertyAnimator.animate(mFab).cancel();
      ViewPropertyAnimator.animate(mFab).scaleX(1).scaleY(1).setDuration(200).start();
      mFabIsShown = true;
    }
  }

  private void hideFab() {
    if (mFabIsShown) {
      ViewPropertyAnimator.animate(mFab).cancel();
      ViewPropertyAnimator.animate(mFab).scaleX(0).scaleY(0).setDuration(200).start();
      mFabIsShown = false;
    }
  }
</code></pre>
<p>We need a state variable to indicate whether the FAB is shown or not.</p>
<p>That&#39;s all.</p>
<p><a href="../../docs/basic/filling-gap.md">Next: Filling gap on top of the Toolbar &raquo;</a></p>
</div>
</div>
</div>

<div class="footer">
    <div class="btns">
        <iframe class="ghstar" src="https://ghbtns.com/github-btn.html?user=ksoichiro&repo=Android-ObservableScrollView&type=star&count=true" frameborder="0" scrolling="0" ></iframe>
        <iframe class="ghfork" src="https://ghbtns.com/github-btn.html?user=ksoichiro&repo=Android-ObservableScrollView&type=fork&count=true" frameborder="0" scrolling="0" ></iframe>
    </div>
    <div class="copyright">
        Android is a trademark of Google Inc.<br />
        © Copyright 2014, Soichiro Kashima.
    </div>
</div>

<script src="/Android-ObservableScrollView/lib/jquery/dist/jquery.min.js"></script>
<script src="/Android-ObservableScrollView/lib/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/Android-ObservableScrollView/lib/highlightjs/highlight.pack.js"></script>
<script src="/Android-ObservableScrollView/js/main.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
