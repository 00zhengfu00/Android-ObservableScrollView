<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Language" content="en" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Sticky header | Android-ObservableScrollView</title>
<meta name="description" content="Android library to observe scroll events on scrollable views." />
<meta name="robots" content="index" />
<meta property="og:type" content="article" />
<meta property="og:site_name" content="Android-ObservableScrollView | Android library to observe scroll events on scrollable views." />
<meta property="og:title" content="Sticky header | Android-ObservableScrollView" />
<meta property="og:url" content="http://ksoichiro.github.io/Android-ObservableScrollView" />
<meta property="og:description" content="Android library to observe scroll events on scrollable views." />
<meta property="og:image" content="/Android-ObservableScrollView/thumbnail.png" />
<meta property="og:locale" content="en" />
<link rel="stylesheet" type="text/css" href="/Android-ObservableScrollView/lib/bootstrap/dist/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="/Android-ObservableScrollView/css/main.css" />
<!--[if lt IE 9]>
<script src="/Android-ObservableScrollView/lib/html5shiv/dist/html5shiv.min.js"></script>
<script src="/Android-ObservableScrollView/lib/respond-minmax/dest/respond.min.js"></script>
<![endif]-->
<link rel="apple-touch-icon" sizes="57x57" href="/Android-ObservableScrollView/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/Android-ObservableScrollView/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/Android-ObservableScrollView/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/Android-ObservableScrollView/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/Android-ObservableScrollView/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/Android-ObservableScrollView/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/Android-ObservableScrollView/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/Android-ObservableScrollView/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/Android-ObservableScrollView/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192"  href="/Android-ObservableScrollView/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/Android-ObservableScrollView/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/Android-ObservableScrollView/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/Android-ObservableScrollView/favicon-16x16.png" />
<link rel="manifest" href="/Android-ObservableScrollView/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/Android-ObservableScrollView/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />
<meta name="base" content="/Android-ObservableScrollView" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-62586232-1', 'auto');
  ga('send', 'pageview');
</script>

</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/Android-ObservableScrollView/">Android-ObservableScrollView</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/Android-ObservableScrollView/docs/overview">Documentation</a></li>
        <li><a href="/Android-ObservableScrollView/docs/faq">FAQ</a></li>
        <li><a href="https://github.com/ksoichiro/Android-ObservableScrollView">GitHub</a></li>
      </ul>
    </div>
  </div>
</nav>


<div class="container">
<p class="visible-xs">
    <button type="button" class="btn-sidebar-toggle" data-toggle="offcanvas">Show menu</button>
</p>
<div id="grid-content">
<div id="sidebar">
    <ul>
        <li><ul><li class="topic"><a href="/Android-ObservableScrollView/docs/overview">Overview</a></li></ul></li>
        
            
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/quick-start/">Quick start</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/dependencies">Dependencies</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/layout">Layout</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/animation">Animation codes</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/example/">Try the example app</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/google-play">Download from Google Play</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/wercker">Download from wercker</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/android-studio">Build on Android Studio</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/eclipse">Build on Eclipse</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/basic/">Basic techniques</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/show-hide-action-bar">Show and hide the ActionBar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/translating-toolbar">Translating the Toolbar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/parallax-image">Parallax image</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/sticky-header">Sticky header</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/flexible-space-toolbar">Flexible space on the Toolbar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/flexible-space-with-image">Flexible space with image</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/filling-gap">Filling gap on top of the Toolbar</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/advanced/">Advanced techniques</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/advanced/sliding-up">Sliding up pattern</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/advanced/viewpager">ViewPager pattern</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/contributor/">For contributors</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/ci">CI</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/update-website">Update website</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/release">Release</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/reference/">Reference</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/supported-widgets">Supported widgets</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/environment">Environment</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/release-notes">Release notes</a></li>
                        
                    
                </ul>
            </li>
        
    </ul>
</div>
<div id="sidebar-main-content">
<h1>Sticky header</h1><p>This topic describes how to keep header on top of the screen,
which are implemented in the following examples.</p>
<ul>
<li>StickyHeaderListViewActivity</li>
<li>StickyHeaderRecyclerViewActivity</li>
<li>StickyHeaderScrollViewActivity</li>
<li>StickyHeaderWebViewActivity</li>
</ul>
<hr>
<h2>Overview</h2><p>This is a complex version of <a href="../../docs/basic/translating-toolbar.md">Toolbar translation pattern</a>.</p>
<p>We add a features to keep the half of the header view to the top of the screen.
And this time I&#39;ll explain using ScrollView.
Replacing it to other type of scrollable views are not so difficult.</p>
<h2>Using ScrollView</h2><h3>Layout with ScrollView</h3><p>Let&#39;s look at the layout file as always.</p>
<p>Here is the basic structure of StickyHeader pattern with ScrollView.
This is a little difficult than Toolbar&#39;s one.</p>
<pre><code class="language-xml">&lt;FrameLayout&gt;
  &lt;ObservableScrollView android:id=&quot;@+id/scroll&quot;&gt;
    &lt;LinearLayout android:orientation=&quot;vertical&quot;&gt;
      &lt;View android:minHeight=&quot;?attr/actionBarSize&quot;/&gt;
      &lt;View android:minHeight=&quot;?attr/actionBarSize&quot;/&gt;
      &lt;TextView/&gt;
    &lt;/LinearLayout&gt;
  &lt;/ObservableScrollView&gt;
  &lt;LinearLayout
    android:id=&quot;@+id/header&quot;
    android:orientation=&quot;vertical&quot;&gt;
    &lt;Toolbar
      android:id=&quot;@+id/toolbar&quot;
      android:minHeight=&quot;?attr/actionBarSize&quot;/&gt;
    &lt;TextView
      android:id=&quot;@+id/sticky&quot;
      android:layout_height=&quot;?attr/actionBarSize&quot;/&gt;
  &lt;/LinearLayout&gt;
&lt;/FrameLayout&gt;
</code></pre>
<p>In Toolbar translation pattern, we used only <code>ObservableScrollView</code> and <code>Toolbar</code> in <code>FrameLayout</code>.
This time, we need to make each views more complex.</p>
<h4>Create header space for ScrollView with twice the size of ActionBar</h4><p>At the initial state of views, ScrollView needs to have a header view with twice the size of the ActionBar.
The half of this header view will be &quot;sticky&quot;.<br>So we simply add 2 <code>View</code>s with the height <code>?attr/actionBarSize</code> above the <code>TextView</code>.</p>
<p>You can also add just 1 <code>View</code> with a certain size with <code>dp</code>,
but it&#39;s better to use <code>?attr/actionBarSize</code> because it has multiple values for several size of screens,
screen rotation and OS versions, and using the standard size is good for users.</p>
<p>Another way to achieve this, is to set the height of the <code>View</code> programmatically.
You can resolve the value of <code>?attr/actionBarSize</code> in <code>Activity#onCreate()</code>, multiply it by 2 and set it to the <code>View</code>.</p>
<p>And please note that <code>TextView</code> is the real content of the ScrollView, so you can replace it to other view if you want.</p>
<h4>Create sticky part for Toolbar</h4><p>Toolbar is replaced to <code>LinearLayout</code>, and it contains a Toolbar and a <code>TextView</code>.
<code>TextView</code> will be the &quot;sticky&quot; view.
You can replace it to some complex views.</p>
<h3>Animate the views with ScrollView callbacks</h3><p>This time, we use two callbacks: <code>onScrollChanged()</code> and <code>onUpOrCancelMotionEvent()</code> to animate views.
We are going to implement the following animation.</p>
<ol>
<li>Move the Toolbar and the sticky view (we call &quot;header views&quot;) when the ScrollView is scrolled.</li>
<li>When we scroll the ScrollView, the Toolbar will go out of the screen.
But when we scroll it more, sticky view must keep its position to the top of the screen.</li>
<li>When the Toolbar is not completely hidden and we stop scrolling (touch up the ScrollView),<ul>
<li>the Toolbar will be shown completely, if we were swiping down.</li>
<li>the Toolbar will be hidden completely, if we were swiping up.</li>
</ul>
</li>
<li>When we swipe down the ScrollView and touch up, the header view should
come out immediately. Sometimes it&#39;s called &quot;Quick Return&quot; pattern.</li>
</ol>
<h4>Move the header view when ScrollView is scrolled</h4><p>Override the <code>onScrollChanged()</code>, and implement some codes with the condition <code>if (dragging)</code>.</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  if (dragging) {
    // TODO implement the rest of the codes
  //} else { // ScrollView is scrolled by inertia
  }
}
</code></pre>
<p>This is because we want to move views only when it is dragged.
Without this, we cannot achieve the 3rd condition above: showing or hiding the Toolbar automatically
when the scroll ended.</p>
<p>Next step, implement the header view translation.<br>At first, create a field with name <code>mHeaderView</code>, and initialize it in <code>onCreate()</code>:</p>
<pre><code class="language-java">mHeaderView = findViewById(R.id.header);
</code></pre>
<p>When the scrollY parameter gets increased, the translationY of <code>mHeaderView</code> should decrease.
So we can write like this:</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  if (dragging) {
    ViewHelper.setTranslationY(mHeaderView, -scrollY);
  }
}
</code></pre>
<h4>Sticky view must keep its position to the top of the screen</h4><p>The header view will disappear completely, and this is not what we want.
<code>mHeaderView</code> should stop after moving the height of Toolbar.</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  if (dragging) {
    int toolbarHeight = mToolbarView.getHeight();
    ViewHelper.setTranslationY(mHeaderView, Math.max(-toolbarHeight, -scrollY));
  }
}
</code></pre>
<p>You can see the sticky view keeping its position to the top of the screen.</p>
<h4>When Toolbar is not completely hidden, show or hide it completely</h4><p>To do this, we should implement <code>onUpOrCancelMotionEvent</code>.<br>If we swipe down, Toolbar should be shown,
and if we swipe up, Toolbar should be hidden.</p>
<pre><code class="language-java">@Override
public void onUpOrCancelMotionEvent(ScrollState scrollState) {
  if (scrollState == ScrollState.DOWN) {
    showToolbar();
  } else if (scrollState == ScrollState.UP) {
    hideToolbar();
  }
}
</code></pre>
<p>But when we swipe up and scrolled less than Toolbar&#39;s height,
hiding the Toolbar makes white space around the top of the ScrollView.<br>So we should show the Toolbar if <code>scrollY</code> is less than Toolbar&#39;s height.</p>
<pre><code class="language-java">@Override
public void onUpOrCancelMotionEvent(ScrollState scrollState) {
  if (scrollState == ScrollState.DOWN) {
    showToolbar();
  } else if (scrollState == ScrollState.UP) {
    int toolbarHeight = mToolbarView.getHeight();
    int scrollY = mScrollView.getCurrentScrollY();
    if (toolbarHeight &lt;= scrollY) {
      hideToolbar();
    } else {
      showToolbar();
    }
  }
}
</code></pre>
<p>And sometimes <code>scrollState</code> becomes <code>STOP</code> (or <code>null</code>).
If it becomes such values, the header view stops halfway.
To avoid this behavior, write <code>else</code> clause.</p>
<pre><code class="language-java">@Override
public void onUpOrCancelMotionEvent(ScrollState scrollState) {
  if (scrollState == ScrollState.DOWN) {
    showToolbar();
  } else if (scrollState == ScrollState.UP) {
    int toolbarHeight = mToolbarView.getHeight();
    int scrollY = mScrollView.getCurrentScrollY();
    if (toolbarHeight &lt;= scrollY) {
      hideToolbar();
    } else {
      showToolbar();
    }
  } else {
    // Even if onScrollChanged occurs without scrollY changing, toolbar should be adjusted
    if (!toolbarIsShown() &amp;&amp; !toolbarIsHidden()) {
      // Toolbar is moving but doesn&#39;t know which to move:
      // you can change this to hideToolbar()
      showToolbar();
    }
  }
}
</code></pre>
<p>Then write the unimplemented methods.<br>Unlike Toolbar translation pattern, we use <code>ViewPropertyAnimator.animate()</code>
because it&#39;s simple and we don&#39;t have to change the height of views.</p>
<pre><code class="language-java">private boolean toolbarIsShown() {
  return ViewHelper.getTranslationY(mHeaderView) == 0;
}

private boolean toolbarIsHidden() {
  return ViewHelper.getTranslationY(mHeaderView) == -mToolbarView.getHeight();
}

private void showToolbar() {
  float headerTranslationY = ViewHelper.getTranslationY(mHeaderView);
  if (headerTranslationY != 0) {
    ViewPropertyAnimator.animate(mHeaderView).cancel();
    ViewPropertyAnimator.animate(mHeaderView).translationY(0).setDuration(200).start();
  }
}

private void hideToolbar() {
  float headerTranslationY = ViewHelper.getTranslationY(mHeaderView);
  int toolbarHeight = mToolbarView.getHeight();
  if (headerTranslationY != -toolbarHeight) {
    ViewPropertyAnimator.animate(mHeaderView).cancel();
    ViewPropertyAnimator.animate(mHeaderView).translationY(-toolbarHeight).setDuration(200).start();
  }
}
</code></pre>
<p>Once <code>ViewPropertyAnimator.animate()</code> is called, animation will be running in the next 200ms.
And if the next animation(<code>showToolbar()</code> or <code>hideToolbar()</code>) is requested while the animation is running,
the current animation should be canceled.
Therefore we call <code>ViewPropertyAnimator.animate(mHeaderView).cancel()</code>
before calling <code>start()</code>.</p>
<h4>When swiping up, header view should scroll</h4><p>It&#39;s almost completed, and if you think it&#39;s OK, you don&#39;t have to write the following codes.</p>
<p>When we scroll so much and swip down little, the header view will be shown.
And after that, when we drag ScrollView to upper side,
I think that the header view should move with ScrollView, but it doesn&#39;t.</p>
<p>So we make the header view to scroll even when <code>scrollY</code> is larger than the Toolbar&#39;s height.</p>
<p>To do this, we just calculate the distance from the first touch point and the current point.
And the distance from the first touch point become larger than Toolbar&#39;s height,
the header view should not scroll any longer.</p>
<pre><code class="language-java">// Add a field to keep the first scrollY
private int mBaseTranslationY;

@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  if (dragging) {
    int toolbarHeight = mToolbarView.getHeight();
    if (firstScroll) { // Add this if clause
      float currentHeaderTranslationY = ViewHelper.getTranslationY(mHeaderView);
      if (-toolbarHeight &lt; currentHeaderTranslationY) {
        mBaseTranslationY = scrollY;
      }
    }
    // Change -scrollY to -(scrollY - mBaseTranslationY)
    float headerTranslationY = Math.max(-toolbarHeight, -(scrollY - mBaseTranslationY));
    ViewPropertyAnimator.animate(mHeaderView).cancel();
    ViewHelper.setTranslationY(mHeaderView, headerTranslationY);
  }
}

@Override
public void onUpOrCancelMotionEvent(ScrollState scrollState) {
    // Should be cleared when scroll ends
    mBaseTranslationY = 0;
</code></pre>
<p>It&#39;s almost done, but sometimes we can see a weird behavior:
the header view leaves the top of the screen.</p>
<p><img src="../../docs/images/basic_2.png" alt=""></p>
<p>This is because <code>headerTranslationY</code> can become larger than 0,
so it should be limited by using <code>Math.min()</code>.</p>
<pre><code class="language-java">float headerTranslationY = Math.min(0, Math.max(-toolbarHeight, -(scrollY - mBaseTranslationY));
</code></pre>
<p>Now it&#39;s working, but don&#39;t you think it&#39;s a little complicated expression?<br>Android-ObservableScrollView provides a small utility class <code>ScrollUtils</code>,
and we can replace <code>Math.min(max, Math.max(min, value))</code> to <code>ScrollUtils.getFloat()</code>.</p>
<pre><code class="language-java">float headerTranslationY = ScrollUtils.getFloat(-(scrollY - mBaseTranslationY), -toolbarHeight, 0);
</code></pre>
<p>Of course, you can confirm the meaning of each parameters easily.
Pressing <code>F1</code> key on <code>getFloat()</code> will show the javadoc window:</p>
<p><img src="../../docs/images/basic_3.png" alt=""></p>
<p><a href="../../docs/basic/flexible-space-toolbar.md">Next: Flexible space on the Toolbar &raquo;</a></p>
</div>
</div>
</div>

<div class="footer">
    <div class="btns">
        <iframe class="ghstar" src="https://ghbtns.com/github-btn.html?user=ksoichiro&repo=Android-ObservableScrollView&type=star&count=true" frameborder="0" scrolling="0" ></iframe>
        <iframe class="ghfork" src="https://ghbtns.com/github-btn.html?user=ksoichiro&repo=Android-ObservableScrollView&type=fork&count=true" frameborder="0" scrolling="0" ></iframe>
    </div>
    <div class="copyright">
        Android is a trademark of Google Inc.<br />
        © Copyright 2014, Soichiro Kashima.
    </div>
</div>

<script src="/Android-ObservableScrollView/lib/jquery/dist/jquery.min.js"></script>
<script src="/Android-ObservableScrollView/lib/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/Android-ObservableScrollView/lib/highlightjs/highlight.pack.js"></script>
<script src="/Android-ObservableScrollView/js/main.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
