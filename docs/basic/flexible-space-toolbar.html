<!DOCTYPE html>
<html prefix="og: http://ogp.me/ns#">
<head>
<meta charset="UTF-8" />
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta http-equiv="Content-Language" content="en" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Flexible space on the Toolbar | Android-ObservableScrollView</title>
<meta name="description" content="Android library to observe scroll events on scrollable views." />
<meta name="robots" content="index" />
<meta property="og:type" content="article" />
<meta property="og:site_name" content="Android-ObservableScrollView | Android library to observe scroll events on scrollable views." />
<meta property="og:title" content="Flexible space on the Toolbar | Android-ObservableScrollView" />
<meta property="og:url" content="http://ksoichiro.github.io/Android-ObservableScrollView" />
<meta property="og:description" content="Android library to observe scroll events on scrollable views." />
<meta property="og:image" content="/Android-ObservableScrollView/thumbnail.png" />
<meta property="og:locale" content="en" />
<link rel="stylesheet" type="text/css" href="/Android-ObservableScrollView/lib/bootstrap/dist/css/bootstrap.min.css" />
<link rel="stylesheet" type="text/css" href="/Android-ObservableScrollView/css/main.css" />
<!--[if lt IE 9]>
<script src="/Android-ObservableScrollView/lib/html5shiv/dist/html5shiv.min.js"></script>
<script src="/Android-ObservableScrollView/lib/respond-minmax/dest/respond.min.js"></script>
<![endif]-->
<link rel="apple-touch-icon" sizes="57x57" href="/Android-ObservableScrollView/apple-icon-57x57.png" />
<link rel="apple-touch-icon" sizes="60x60" href="/Android-ObservableScrollView/apple-icon-60x60.png" />
<link rel="apple-touch-icon" sizes="72x72" href="/Android-ObservableScrollView/apple-icon-72x72.png" />
<link rel="apple-touch-icon" sizes="76x76" href="/Android-ObservableScrollView/apple-icon-76x76.png" />
<link rel="apple-touch-icon" sizes="114x114" href="/Android-ObservableScrollView/apple-icon-114x114.png" />
<link rel="apple-touch-icon" sizes="120x120" href="/Android-ObservableScrollView/apple-icon-120x120.png" />
<link rel="apple-touch-icon" sizes="144x144" href="/Android-ObservableScrollView/apple-icon-144x144.png" />
<link rel="apple-touch-icon" sizes="152x152" href="/Android-ObservableScrollView/apple-icon-152x152.png" />
<link rel="apple-touch-icon" sizes="180x180" href="/Android-ObservableScrollView/apple-icon-180x180.png" />
<link rel="icon" type="image/png" sizes="192x192"  href="/Android-ObservableScrollView/android-icon-192x192.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/Android-ObservableScrollView/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="96x96" href="/Android-ObservableScrollView/favicon-96x96.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/Android-ObservableScrollView/favicon-16x16.png" />
<link rel="manifest" href="/Android-ObservableScrollView/manifest.json" />
<meta name="msapplication-TileColor" content="#ffffff" />
<meta name="msapplication-TileImage" content="/Android-ObservableScrollView/ms-icon-144x144.png" />
<meta name="theme-color" content="#ffffff" />
<meta name="base" content="/Android-ObservableScrollView" />
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-62586232-1', 'auto');
  ga('send', 'pageview');
</script>

</head>
<body>

<nav class="navbar navbar-inverse navbar-fixed-top">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="/Android-ObservableScrollView/">Android-ObservableScrollView</a>
    </div>
    <div id="navbar" class="collapse navbar-collapse">
      <ul class="nav navbar-nav">
        <li><a href="/Android-ObservableScrollView/docs/overview">Documentation</a></li>
        <li><a href="/Android-ObservableScrollView/docs/faq">FAQ</a></li>
        <li><a href="https://github.com/ksoichiro/Android-ObservableScrollView">GitHub</a></li>
      </ul>
    </div>
  </div>
</nav>


<div class="container">
<p class="visible-xs">
    <button type="button" class="btn-sidebar-toggle" data-toggle="offcanvas">Show menu</button>
</p>
<div id="grid-content">
<div id="sidebar">
    <ul>
        <li><ul><li class="topic"><a href="/Android-ObservableScrollView/docs/overview">Overview</a></li></ul></li>
        
            
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/quick-start/">Quick start</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/dependencies">Dependencies</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/layout">Layout</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/quick-start/animation">Animation codes</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/example/">Try the example app</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/google-play">Download from Google Play</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/wercker">Download from wercker</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/android-studio">Build on Android Studio</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/example/eclipse">Build on Eclipse</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/basic/">Basic techniques</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/show-hide-action-bar">Show and hide the ActionBar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/translating-toolbar">Translating the Toolbar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/parallax-image">Parallax image</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/sticky-header">Sticky header</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/flexible-space-toolbar">Flexible space on the Toolbar</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/flexible-space-with-image">Flexible space with image</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/basic/filling-gap">Filling gap on top of the Toolbar</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/advanced/">Advanced techniques</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/advanced/sliding-up">Sliding up pattern</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/advanced/viewpager">ViewPager pattern</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/contributor/">For contributors</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/ci">CI</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/update-website">Update website</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/contributor/release">Release</a></li>
                        
                    
                </ul>
            </li>
        
            
            <li>
                <h4 class="section"><a href="/Android-ObservableScrollView/docs/reference/">Reference</a></h4>
                <ul>
                    
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/supported-widgets">Supported widgets</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/environment">Environment</a></li>
                        
                    
                        
                            <li class="topic"><a href="/Android-ObservableScrollView/docs/reference/release-notes">Release notes</a></li>
                        
                    
                </ul>
            </li>
        
    </ul>
</div>
<div id="sidebar-main-content">
<h1>Flexible space on the Toolbar</h1><p>This topic describes how to create flexible space on the Toolbar,
which are implemented in the following examples.</p>
<ul>
<li>FlexibleSpaceToolbarScrollViewActivity</li>
<li>FlexibleSpaceToolbarWebViewActivity</li>
</ul>
<p>I originally tried implementing this pattern (only the title animation):<br><a href="http://material-design.storage.googleapis.com/publish/material_v_3/material_ext_publish/0B969e8h0awhvQ3lJdU9WVTh1WWM/patterns_scrolling_flexspaceimage.webm">Flexible space with image</a></p>
<hr>
<h2>Using ScrollView</h2><h3>Layout with ScrollView</h3><h4>Basic structure</h4><pre><code class="language-xml">&lt;FrameLayout&gt;
  &lt;ObservableScrollView android:id=&quot;@+id/scroll&quot;&gt;
    &lt;FrameLayout android:id=&quot;@+id/body&quot;&gt;
      &lt;TextView/&gt;
    &lt;/FrameLayout&gt;
  &lt;/ObservableScrollView&gt;
  &lt;View android:id=&quot;@+id/flexible_space&quot;/&gt;
  &lt;Toolbar android:id=&quot;@+id/toolbar&quot;/&gt;
  &lt;RelativeLayout android:paddingLeft=&quot;@dimen/toolbar_margin_start&quot;&gt;
    &lt;TextView android:id=&quot;@+id/title&quot;/&gt;
    &lt;LinearLayout android:orientation=&quot;vertical&quot;&gt;
      &lt;View android:layout_height=&quot;?attr/actionBarSize&quot;/&gt;
      &lt;View android:layout_height=&quot;@dimen/flexible_space_height&quot;/&gt;
    &lt;/LinearLayout&gt;
  &lt;/RelativeLayout&gt;
&lt;/FrameLayout&gt;
</code></pre>
<p>The root <code>FrameLayout</code> is used for moving children separately.</p>
<p>The second <code>FrameLayout</code>(<code>@id/body</code>) inside the ScrollView is the main content,
and you can put any views as you like.
This time, we&#39;ll add just a <code>TextView</code>.</p>
<p><code>View</code>(<code>@id/flexible_space</code>) is for a &quot;flexible space&quot; which has a opaque background.
This view will be translated vertically on scrolling.</p>
<p><code>Toolbar</code> is a normal Toolbar, but this Toolbar will not have &quot;title&quot;.</p>
<p>The next <code>RelativeLayout</code> and its children are a little tricky.
The <code>TextView</code>(<code>@id/title</code>) is the real title view,
and other views (<code>LinearLayout</code>, <code>View</code>) are padding.
In this &quot;flexible space&quot; pattern, <code>TextView</code>&#39;s text should move and its font size should change,
so it needs additional space.
We&#39;ll achieve these animations by animate <code>TextView</code> itself, so paddings should be outside the <code>TextView</code>.</p>
<p>To confirm other attributes,
please see <code>res/layout/activity_flexiblespacetoolbarscrollview.xml</code> in the example app.</p>
<h3>Initialization</h3><p>At first, set the Toolbar as the ActionBar and show &quot;homeAsUp&quot; button.</p>
<pre><code class="language-java">@Override
protected void onCreate(Bundle savedInstanceState) {
  super.onCreate(savedInstanceState);
  setContentView(R.layout.activity_flexiblespacetoolbarscrollview);

  setSupportActionBar((Toolbar) findViewById(R.id.toolbar));
  getSupportActionBar().setDisplayHomeAsUpEnabled(true);
</code></pre>
<p>And get the Activity&#39;s title and set it to the <code>TextView</code> which has the ID <code>@id/title</code>.</p>
<pre><code class="language-java">  mTitleView = (TextView) findViewById(R.id.title);
  mTitleView.setText(getTitle());
  setTitle(null);
</code></pre>
<p>And initialize other views and fields.</p>
<pre><code class="language-java">private View mFlexibleSpaceView;
private View mToolbarView;
private TextView mTitleView;
private int mFlexibleSpaceHeight;

@Override
protected void onCreate(Bundle savedInstanceState) {
  // Codes that are already explained above are omitted
  mFlexibleSpaceView = findViewById(R.id.flexible_space);
  mToolbarView = findViewById(R.id.toolbar);

  final ObservableScrollView scrollView = (ObservableScrollView) findViewById(R.id.scroll);
  scrollView.setScrollViewCallbacks(this);

  mFlexibleSpaceHeight = getResources().getDimensionPixelSize(R.dimen.flexible_space_height);
  int flexibleSpaceAndToolbarHeight = mFlexibleSpaceHeight + getActionBarSize();

  findViewById(R.id.body).setPadding(0, flexibleSpaceAndToolbarHeight, 0, 0);
  mFlexibleSpaceView.getLayoutParams().height = flexibleSpaceAndToolbarHeight;
}
</code></pre>
<p>You should also add <code>implements ObservableScrollViewCallbacks</code> to the Activity
and implement those methods as always.</p>
<h3>Animation</h3><p>We use <code>onScrollChanged()</code> to create animation.
We must write following codes:</p>
<ul>
<li>Translate the flexible space view</li>
<li>Translate and scale the title view</li>
</ul>
<h4>Translate the flexible space view</h4><p>This is easy, just translate it using <code>scrollY</code>:</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  ViewHelper.setTranslationY(mFlexibleSpaceView, -scrollY);
}
</code></pre>
<h4>Scale the title view</h4><p>How do you change the size of the font?<br>At first I tried just changing the size of the font, but it didn&#39;t work. It should be scaled.</p>
<p>The scale should change from <code>1</code> to <code>1.x</code>. You can change <code>.x</code> to fit your app.
In this case, I used the height of the flexible space and the height of the Toolbar. This calculates the maximum <code>.x</code>:</p>
<pre><code class="language-java">float maxScale = (float) (mFlexibleSpaceHeight - mToolbarView.getHeight()) / mToolbarView.getHeight();
</code></pre>
<p>The scale (we call <code>.x</code> part as &quot;scale&quot; from here) should change between 0 to <code>maxScale</code>, so it can be written as follows.</p>
<pre><code class="language-java">// scrollY should be limited.
int adjustedScrollY = (int) ScrollUtils.getFloat(scrollY, 0, mFlexibleSpaceHeight);

// When scrollY is 0, scale equals to maxScale.
// When scrollY reaches to mFlexibleSpaceHeight, scale will be 0.
float scale = maxScale * ((float) mFlexibleSpaceHeight - adjustedScrollY) / mFlexibleSpaceHeight;
</code></pre>
<p>When scaling the view, we need to set the center point of scaling.
You can handle this by using <code>pivotX</code> and <code>pivotY</code>, and we should set them to <code>(0, 0)</code> like this image:</p>
<p><img src="../images/basic_4.png" alt=""></p>
<p>We will set <code>pivotX</code> and <code>pivotY</code> first, and then change the scale:</p>
<pre><code class="language-java">// Pivot the title view to (0, 0)
ViewHelper.setPivotX(mTitleView, 0);
ViewHelper.setPivotY(mTitleView, 0);

// Scale the title view
ViewHelper.setScaleX(mTitleView, 1 + scale);
ViewHelper.setScaleY(mTitleView, 1 + scale);
</code></pre>
<h4>Translate the title view</h4><p>And about <code>translationY</code>, this is a little complicated.
Let&#39;s see the following picture.</p>
<p><img src="../images/basic_5.png" alt=""></p>
<p>The minimum <code>translationY</code> is obviously 0, and we want to know
the maximum <code>translationY</code>.
As we can see in the picture, the maximum <code>translationY</code> can be calculated with <code>ht1 + hf - ht2</code>, so we can write like this:</p>
<pre><code class="language-java">int maxTitleTranslationY = mToolbarView.getHeight() + mFlexibleSpaceHeight - (int) (mTitleView.getHeight() * (1 + scale));
</code></pre>
<p>And we should vary this value using <code>scrollY</code>.
<code>scrollY</code> should be limited and it&#39;s already calculated as <code>adjustedY</code>:</p>
<pre><code class="language-java">  int titleTranslationY = (int) (maxTitleTranslationY * ((float) mFlexibleSpaceHeight - adjustedScrollY) / mFlexibleSpaceHeight);
  ViewHelper.setTranslationY(mTitleView, titleTranslationY);
</code></pre>
<p>Finally, we&#39;ve finished translation and scaling.</p>
<pre><code class="language-java">@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  ViewHelper.setTranslationY(mFlexibleSpaceView, -scrollY);

  // Calculate scale
  int adjustedScrollY = (int) ScrollUtils.getFloat(scrollY, 0, mFlexibleSpaceHeight);
  float maxScale = (float) (mFlexibleSpaceHeight - mToolbarView.getHeight()) / mToolbarView.getHeight();
  float scale = maxScale * ((float) mFlexibleSpaceHeight - adjustedScrollY) / mFlexibleSpaceHeight;

  // Pivot the title view to (0, 0)
  ViewHelper.setPivotX(mTitleView, 0);
  ViewHelper.setPivotY(mTitleView, 0);

  // Scale the title view
  ViewHelper.setScaleX(mTitleView, 1 + scale);
  ViewHelper.setScaleY(mTitleView, 1 + scale);

  // Translate the title view
  int maxTitleTranslationY = mToolbarView.getHeight() + mFlexibleSpaceHeight - (int) (mTitleView.getHeight() * (1 + scale));
  int titleTranslationY = (int) (maxTitleTranslationY * ((float) mFlexibleSpaceHeight - adjustedScrollY) / mFlexibleSpaceHeight);
  ViewHelper.setTranslationY(mTitleView, titleTranslationY);
}
</code></pre>
<h4>Adjust the initial state of the title</h4><p>It&#39;s almost finished, but maybe you will notice
that when the screen is launched,
the title is located at the top of the screen.
It should be located at the bottom of the header view area and have larger font.</p>
<p>This is because <code>onScrollChanged()</code> is not called.<br>You can fix that by calling <code>onScrollChanged()</code> just after the views are laied out.
And you can handle this &quot;laid out&quot; event by using <code>ViewTreeObserver#addOnGlobalLayoutListener()</code>.</p>
<pre><code class="language-java">@Override
protected void onCreate(Bundle savedInstanceState) {
  // Other initialization codes are omitted
  ViewTreeObserver vto = mTitleView.getViewTreeObserver();
  vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
    @Override
    public void onGlobalLayout() {
      if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.JELLY_BEAN) {
        view.getViewTreeObserver().removeGlobalOnLayoutListener(this);
      } else {
        view.getViewTreeObserver().removeOnGlobalLayoutListener(this);
      }
      updateFlexibleSpaceText(scrollView.getCurrentScrollY());
    }
  });
}

@Override
public void onScrollChanged(int scrollY, boolean firstScroll, boolean dragging) {
  updateFlexibleSpaceText(scrollY);
}

private void updateFlexibleSpaceText(scrollY) {
  // Original animation codes are omitted
}
</code></pre>
<p>You can replace the following <code>ViewTreeObserver</code> codes</p>
<pre><code class="language-java">ViewTreeObserver vto = mTitleView.getViewTreeObserver();
vto.addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener() {
  @Override
  public void onGlobalLayout() {
    if (Build.VERSION.SDK_INT &lt; Build.VERSION_CODES.JELLY_BEAN) {
      view.getViewTreeObserver().removeGlobalOnLayoutListener(this);
    } else {
      view.getViewTreeObserver().removeOnGlobalLayoutListener(this);
    }
    updateFlexibleSpaceText(scrollView.getCurrentScrollY());
  }
});
</code></pre>
<p>to this:</p>
<pre><code class="language-java">ScrollUtils.addOnGlobalLayoutListener(mTitleView, new Runnable() {
  @Override
  public void run() {
    updateFlexibleSpaceText(scrollView.getCurrentScrollY());
  }
});
</code></pre>
<p>That&#39;s all!</p>
<p><a href="../../docs/basic/flexible-space-with-image.md">Next: Flexible space with image &raquo;</a></p>
</div>
</div>
</div>

<div class="footer">
    <div class="btns">
        <iframe class="ghstar" src="https://ghbtns.com/github-btn.html?user=ksoichiro&repo=Android-ObservableScrollView&type=star&count=true" frameborder="0" scrolling="0" ></iframe>
        <iframe class="ghfork" src="https://ghbtns.com/github-btn.html?user=ksoichiro&repo=Android-ObservableScrollView&type=fork&count=true" frameborder="0" scrolling="0" ></iframe>
    </div>
    <div class="copyright">
        Android is a trademark of Google Inc.<br />
        © Copyright 2014, Soichiro Kashima.
    </div>
</div>

<script src="/Android-ObservableScrollView/lib/jquery/dist/jquery.min.js"></script>
<script src="/Android-ObservableScrollView/lib/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/Android-ObservableScrollView/lib/highlightjs/highlight.pack.js"></script>
<script src="/Android-ObservableScrollView/js/main.js"></script>
<script>hljs.initHighlightingOnLoad();</script>

</body>
</html>
